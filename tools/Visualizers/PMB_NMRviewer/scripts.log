////////////////////////////////////////////////////////////////////////

INSTALLATION

////////////////////////////////////////////////////////////////////////

#
# Requirements
#

[me@mach ~]$ uname -a
Linux mach 2.6.18-238.19.1.el5PAE #1 SMP Fri Jul 15 08:15:44 EDT 2011 i686 athlon i386 GNU/Linux

[me@mach ~]$ cat /etc/redhat-release 
CentOS release 5.6 (Final)

[me@mach ~]$ which gnuplot
/usr/local/bin/gnuplot

[me@mach ~]$ /usr/local/bin/gnuplot -V
gnuplot 4.3 patchlevel 0

[me@mach ~]$ /usr/sbin/httpd -v
Server version: Apache/2.2.3
Server built:   May  4 2011 06:51:15

[me@mach ~]$ /usr/sbin/httpd -l
Compiled in modules:
  core.c
  prefork.c
  http_core.c
  mod_so.c

[me@mach ~]$ php -v
PHP 5.1.6 (cli) (built: Nov 29 2010 16:47:37) 
Copyright (c) 1997-2006 The PHP Group
Zend Engine v2.1.0, Copyright (c) 1998-2006 Zend Technologies

#
# uncompress the nmrview.tar.gz archive
#

[me@mach projets]$ 
[me@mach projets]$ pwd
/mnt/var/sys/projets
[me@mach projets]$ 
[me@mach projets]$ ll ./nmrview.tar.gz 
-rw-r--r-- 1 me users 20401644 Mar 26 15:44 ./nmrview.tar.gz

[me@mach projets]$ tar xvzf ./nmrview.tar.gz 
./nmrview/
./nmrview/www/
./nmrview/www/tmp
./nmrview/www/js/
./nmrview/www/js/spectrum.js
./nmrview/www/js/ui.nmrview.js
./nmrview/www/js/utils.js
./nmrview/www/etc
./nmrview/www/images/
./nmrview/www/images/img_00.gif
./nmrview/www/images/loading.gif
./nmrview/www/php/
./nmrview/www/php/Set_Config.inc
./nmrview/www/php/config.inc
./nmrview/www/php/getnmrspec.inc
./nmrview/www/php/main.inc
./nmrview/www/php/nmrproc_conf.inc
./nmrview/www/php/nmrproc_ui.inc
./nmrview/www/php/nmrproc_view.inc
./nmrview/www/.htaccess
./nmrview/www/css/
./nmrview/www/css/redmond/
./nmrview/www/css/redmond/images/
./nmrview/www/css/redmond/images/ui-icons_217bc0_256x240.png
./nmrview/www/css/redmond/images/animated-overlay.gif
./nmrview/www/css/redmond/images/ui-bg_gloss-wave_55_5c9ccc_500x100.png
./nmrview/www/css/redmond/images/ui-bg_flat_0_aaaaaa_40x100.png
./nmrview/www/css/redmond/images/ui-bg_flat_55_fbec88_40x100.png
./nmrview/www/css/redmond/images/ui-bg_glass_75_d0e5f5_1x400.png
./nmrview/www/css/redmond/images/ui-bg_glass_85_dfeffc_1x400.png
./nmrview/www/css/redmond/images/ui-bg_glass_95_fef1ec_1x400.png
./nmrview/www/css/redmond/images/ui-bg_inset-hard_100_f5f8f9_1x100.png
./nmrview/www/css/redmond/images/ui-bg_inset-hard_100_fcfdfd_1x100.png
./nmrview/www/css/redmond/images/ui-icons_2e83ff_256x240.png
./nmrview/www/css/redmond/images/ui-icons_469bdd_256x240.png
./nmrview/www/css/redmond/images/ui-icons_6da8d5_256x240.png
./nmrview/www/css/redmond/images/ui-icons_cd0a0a_256x240.png
./nmrview/www/css/redmond/images/ui-icons_d8e7f3_256x240.png
./nmrview/www/css/redmond/images/ui-icons_f9bd01_256x240.png
./nmrview/www/css/redmond/jquery-ui.min.css
./nmrview/www/css/redmond/jquery-ui.css
./nmrview/www/css/redmond/jquery.ui.theme.css
./nmrview/www/view
./nmrview/www/log/
./nmrview/www/log/tracing/
./nmrview/www/log/tracing/147.100.111.154
./nmrview/www/log/access.log
./nmrview/www/view.php
./nmrview/etc/
./nmrview/etc/nmrproc.conf
./nmrview/bin/
./nmrview/bin/corrige_1r
./nmrview/bin/pack_1r
./nmrview/bin/bin4gp_1r
./nmrview/bin/geoloc_check.sh
./nmrview/bin/pack_bruker
./nmrview/bin/pack_jdx
./nmrview/bin/parserBruker
./nmrview/bin/parserJCAMP
./nmrview/bin/parserJCAMP.pl
./nmrview/bin/tab2csv
./nmrview/data/
./nmrview/examples/
./nmrview/examples/simple.html
./nmrview/tmp/

[me@mach projets]$ cd nmrview

[me@mach nmrview]$ ll
total 24
drwxr-xr-x 2 me users 4096 Mar 26 15:13 bin
drwxr-xr-x 3 me users 4096 Mar 26 14:55 data
drwxr-xr-x 2 me users 4096 Mar 26 15:16 etc
drwxr-xr-x 2 me users 4096 Mar 26 15:29 examples
drwxr-xr-x 2 me users 4096 Mar 26 15:29 tmp
drwxr-xr-x 7 me users 4096 Mar 26 15:27 www

#
# gives the right permissions for apache
#
[me@mach nmrview]$ chmod 777 tmp
[me@mach nmrview]$ chmod -R 777 ./www/log/

#
# Edit the configuration files
#

[me@mach nmrview]$ vi ./etc/nmrproc.conf 
--------------------------------------------------------------------------------------------------------------
# Warning: Take care not putting spaces each side of equal sign, in order to be executed as a script shell 
# VARNAME=anything including spaces

# The root of the bulk of your installation.
# Think to create a symbolic link under the HTML document directory of your web server which points to the www directory of nmrview.
ROOTDIR=/mnt/var/sys/projets/nmrview

# The root of the datasets may be located anywhere else, not necessary under the same directory)
DATASETS=/mnt/var/sys/projets/nmrview/data

# default NMR spectrum parameters
SOLVENT_MIN=4.7
SOLVENT_MAX=4.97
PPM_MIN=-0.05
PPM_MAX=11

...

--------------------------------------------------------------------------------------------------------------

#
# Create a symbolic link under the HTML document directory of your web server which points to the www directory of nmrview.
#
[me@mach nmrview]$ cd /var/www/html/
[me@mach nmrview]$ sudo ln -s /mnt/var/sys/projets/nmrview/www nmrview


////////////////////////////////////////////////////////////////////////

How to process with an ISA-TAB archive ?

////////////////////////////////////////////////////////////////////////

#
# unzip the isatab archive in a temporary directory
#

[me@mach ~]$ unzip HUGO07.isa -d /tmp/HUGO07/
Archive:  HUGO07.isa
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13091.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13092.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13101.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13102.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13111.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13112.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13121.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13122.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13131.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13132.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13141.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13142.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13151.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13152.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13161.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13162.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13171.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13172.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13181.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13182.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13191.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13192.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13201.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13202.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13331.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13332.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13341.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13342.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13351.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13352.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13361.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13362.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13371.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13372.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13381.zip  
 extracting: /tmp/HUGO07/BB_BBI_08M07_melon07_13382.zip  
  inflating: /tmp/HUGO07/a_hugo_2007_metabolite profiling_NMR spectroscopy.txt  
  inflating: /tmp/HUGO07/i_Investigation.txt  
  inflating: /tmp/HUGO07/s_Hugo_2007.txt  

#
# Create an entry under the root of the datasets (see ./etc/nmrproc.conf)
#
  
[me@mach ~]$ cd /mnt/var/sys/projets/nmrview/
[me@mach nmrview]$ 
[me@mach nmrview]$ mkdir ./data/HUGO07

#
# Convert isa_tab metadata files into a CSV file
#

[me@mach nmrview]$ ./bin/tab2csv -d /tmp/HUGO07/ -o samples.csv -v
i_Investigation.txt ... OK
s_Hugo_2007.txt ... OK
a_hugo_2007_metabolite profiling_NMR spectroscopy.txt ... OK
Extract columns from Study Assay File : 1,28 ...OK
Factors: ;Harvest date
Extract columns from Study File : 9,10 ... OK
Merging ...OK

#
# Create the "pack" file : 'pack_bruker' script is for bruker raw files
#

[me@mach nmrview]$ time ./bin/pack_bruker -i /tmp/HUGO07/samples.csv -o ./data/HUGO07/ -h
----------------------------
BB_BBI_08M07_melon07_13091 (1/36) ...
NAME = 07.HU1.1.1309.1
OK
----------------------------
BB_BBI_08M07_melon07_13092 (2/36) ...
NAME = 07.HU1.1.1309.2
OK
----------------------------
BB_BBI_08M07_melon07_13101 (3/36) ...
NAME = 07.HU1.2.1310.1
OK
----------------------------
BB_BBI_08M07_melon07_13102 (4/36) ...
NAME = 07.HU1.2.1310.2
OK

...

----------------------------
BB_BBI_08M07_melon07_13372 (34/36) ...
NAME = 07.HU3.5.1337.2
OK
----------------------------
BB_BBI_08M07_melon07_13381 (35/36) ...
NAME = 07.HU3.6.1338.1
OK
----------------------------
BB_BBI_08M07_melon07_13382 (36/36) ...
NAME = 07.HU3.6.1338.2
OK
Pack ...OK

real    0m39.698s
user    0m13.305s
sys     0m9.039s

#
# Check if all files have been created
#
[me@mach nmrview]$ ll ./data/HUGO07/
total 9756
-rw-r--r-- 1 me users      28 Mar 27 17:57 factors
lrwxrwxrwx 1 me users      11 Mar 27 17:57 rawfile -> samples.csv
-rw-r--r-- 1 me users    1812 Mar 27 17:57 samples.csv
-rw-r--r-- 1 me users 9961496 Mar 27 17:58 specs.pack

#
# Create a simple html page using the example
#

[me@mach nmrview]$ cp examples/simple.html ./www/

[me@mach nmrview]$ vi ./www/simple.html 
--------------------------------------------------------------------------------------------------------------
change the line 13:
       url:'/nmrview/view',  dataset: 'exemple', colorby: 0, width: 'auto'
replace 'example' by 'HUGO07':
       url:'/nmrview/view',  dataset: 'HUGO7', colorby: 0, width: 'auto'
--------------------------------------------------------------------------------------------------------------

#
# In your web browser, open the URL: http:<your domain>/nmrview/simple.html 
#
